<div class="select-window-container">
	<div class="left-content">
		{volist name="structures" id="vo"}
		<dl>
			<dt class="selecting-department"><i class="fa fa-caret-right fa-myleft"></i><i class="fa fa-caret-down fa-myleft"></i><span data-selecting-department-id="{$vo.id}">{$vo.struct_name}</span><i class="fa fa-user fa-myright" title="添加全员"></i><i class="fa fa-sitemap fa-myright" title="添加部门"></i></dt>
			{volist name="vo.employee_ids_arr" id="voe"}
				{if condition="isset($employees[$voe])"}
					<dd data-selecting-staff-id="{$voe}">{$employees[$voe]["nickname"]}</dd>
				{/if}
			{/volist}
		</dl>
		{/volist}
	</div>
	<div class="right-content">
		<div class="right-content-container">
			<dl class="selected-department">
				<dt><i class="fa fa-caret-right fa-myleft"></i><i class="fa fa-caret-down fa-myleft"></i><span>已选择部门(<p>0</p>)</span></dt>
				<!-- <dd data-selected-department-id="0">销售一部<i class="fa fa-times-circle-o"></i></dd> -->
			</dl>
			<dl class="selected-staff">
				<dt><i class="fa fa-caret-right fa-myleft"></i><i class="fa fa-caret-down fa-myleft"></i><span>已选择员工(<p>0</p>)</span></dt>
				<!-- <dd data-selected-staff-id="0">费玉清<i class="fa fa-times-circle-o"></i></dd> -->
			</dl>
		</div>		
		<button class="true">确定</button>
		<button class="false">取消</button>
	</div>
</div>
<script type="text/javascript">
//最终值
let result={
	dep:[],
	stf:[]
}
//开关
$(".select-window-container dl dt span").click(function() {
	$(this).parent().parent().toggleClass("active");
});
$(".select-window-container dl dt .fa-myleft").click(function() {
	$(this).parent().parent().toggleClass("active");
});
//单个选中人员
$(".selecting-department").siblings("dd").click(function(){
	console.log($(this));
	let arr = getElementByAttr('dd','data-selected-staff-id',$(this).attr("data-selecting-staff-id"));
	if(arr.length==0){
		$(".selected-staff").append('<dd data-selected-staff-id="'+$(this).attr("data-selecting-staff-id")+'">'+$(this).text()+'<i class="fa fa-times-circle-o"></i></dd>');
		$(".selected-staff dt p").text($(".selected-staff dd").length);
		result.stf.push($(this).attr("data-selecting-staff-id"));
	}else if(arr.length==1){
		alert("已存在");
	}else{
		alert("参数错误");
	}
});
//单个选中群组
$(".selecting-department .fa-sitemap").click(function(){
	let arr = getElementByAttr('dd','data-selected-department-id',$(this).siblings("span").attr("data-selecting-department-id"));
	if(arr.length==0){
		$(".selected-department").append('<dd data-selected-department-id="'+$(this).siblings("span").attr("data-selecting-department-id")+'">'+$(this).siblings("span").text()+'<i class="fa fa-times-circle-o"></i></dd>');
		$(".selected-department dt p").text($(".selected-department dd").length);
		result.dep.push($(this).siblings("span").attr("data-selecting-department-id"));
	}else if(arr.length==1){
		alert("已存在");
	}else{
		alert("参数错误");
	}
});
//添加群组全员
$(".selecting-department .fa-user").click(function(){
	let arr = $(this).parent().siblings("dd");
	for (var i = 0; i < arr.length; i++) {
		let arr2 = getElementByAttr('dd','data-selected-staff-id',arr.eq(i).attr("data-selecting-staff-id"));
		if(arr2.length==0){
			$(".selected-staff").append('<dd data-selected-staff-id="'+arr.eq(i).attr("data-selecting-staff-id")+'">'+arr.eq(i).text()+'<i class="fa fa-times-circle-o"></i></dd>');
			result.stf.push(arr.eq(i).attr("data-selecting-staff-id"));
		}
	}
	$(".selected-staff dt p").text($(".selected-staff dd").length);
});
//删除--删除部门
$(".right-content-container dl.selected-department").on("click","dd .fa-times-circle-o",function(){
	$(this).parent().remove();
	result.dep.splice(result.dep.indexOf($(this).parent().attr("data-selected-department-id")),1);
	$(".selected-department dt p").text($(".selected-department dd").length);
});
//删除--删除员工
$(".right-content-container dl.selected-staff").on("click","dd .fa-times-circle-o",function(){
	$(this).parent().remove();
	result.stf.splice(result.stf.indexOf($(this).parent().attr("data-selected-staff-id")),1);
	$(".selected-staff dt p").text($(".selected-staff dd").length);
});
//完成
$(".right-content button.true").click(function(){
	var data_val = '';

	var header = "departments[]=";
	var delimiter = "&";
	var dep_arr = result.dep;
	data_val += header+dep_arr.join(delimiter+header);
	console.log(data_val);


	header = "employees[]=";
	delimiter = "&";
	var stf_arr = result.stf;
	data_val += delimiter+header+stf_arr.join(delimiter+header);
	console.log(data_val);

	$("input.select-window-choosen-staff").val("已选择"+result.dep.length+"个部门"+result.stf.length+"个人员").attr("data-val",data_val);
	$(".select-window-container").remove();
});
//取消
$(".right-content button.false").click(function(){
	$(".select-window-container").remove();
});
</script>
<style type="text/css">
.select-window-container{
	font-size: 14px;

}
.select-window-container .left-content{
	width: 250px;
	height: 280px;
	box-shadow: 0px 6px 24px 0px rgba(0, 0, 0, 0.14);
	background-color:white;
	float: left; 
	margin-right: 5px;
	overflow: auto;
}
.select-window-container  dl{
	cursor: pointer;
}
.select-window-container  dl dd{
	position: relative;
}
.select-window-container  dl dt{
	height: 40px;
	line-height: 40px;
	position: relative;
}
.select-window-container  dl dt:hover{
	background-color: #edf2fd;
}
.select-window-container  dl dd:hover{
	background-color: #edf2fd;
}
.select-window-container .left-content dl dt:hover i.fa-myright{
	display: inline-block;
}
.select-window-container  dl dt i{
	position: absolute;
	font-size: 1.5em;
	top: 10px;
}
.select-window-container  dl dt i.fa-myleft{
	left: 20px;
	color: #b2b2b2;
}
.select-window-container .left-content dl dt i.fa-caret-right{
	
}
.select-window-container  dl dt i.fa-caret-down{
	display: none;
}
.select-window-container  dl.active dt i.fa-caret-right{
	display: none;
}
.select-window-container  dl.active dt i.fa-caret-down{
	display: inline-block;
}
.select-window-container .left-content dl dt i.fa-user{
	right: 53px;
	color: #42a5f5;
	display: none;
}
.select-window-container .left-content dl dt i.fa-sitemap{
	right:20px; 
	color: #42a5f5;
	display: none;
}
.select-window-container  dl dt span{
	display: inline-block;
	width: 100%;
	text-indent: 45px;
}
.select-window-container dl dd{
	line-height: 30px;
	padding-left: 46px;
	display: none;
}
.select-window-container dl.active dd{
	display: block;
}
.select-window-container .right-content{
	width: 250px;
	height: 220px;
	padding-bottom: 60px;
	box-shadow: 0px 6px 24px 0px rgba(0, 0, 0, 0.14);
	background-color:white; 
	float: left;
	position: relative;
}
.select-window-container .right-content dl dt span p{
	display: inline;
}
.select-window-container .right-content .right-content-container{
	height: 220px;
	overflow: auto;
}
.select-window-container .right-content dl dd i.fa-times-circle-o{
	font-size: 1.5em;
	color: #42a5f5;
	right: 20px;
	top: 4px;
	position: absolute;
	display: none;
}
.select-window-container .right-content dl dd:hover i.fa-times-circle-o{
	display: inline-block;
}
.select-window-container .right-content button{
	position: absolute;
	bottom: 15px;
	width: 90px;
	/*left: 80px;*/
	border-style: none;
	height: 30px;
	border-radius: 5px;
	background-color: #42a5f5;
	color: white;
}
.select-window-container .right-content button.true{
	left: 30px;
}
.select-window-container .right-content button.false{
	left: 130px;
}
</style>