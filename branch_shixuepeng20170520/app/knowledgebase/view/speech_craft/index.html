<div class="knowledgebase knowledgebase_speechcraft knowledgebase_speechcraft_index">
	<div class="index_panel index">
		<header>
            <ul class="m-firNav">
                <li speechcraft_in_column="0" class="in_column current"><div>所有分类</div></li>
                {volist name="article_type" id="vo"}
                <li speechcraft_in_column="{$vo.id}" class="in_column "><div>{$vo.type_name}</div></li>
                {/volist}
                <!--<li in_column="1" class="in_column "><div>百度业务</div></li>
                <li in_column="2" class="in_column "><div>网站建设</div></li>-->
            </ul>
        </header>
        <section class="m-divBlock m-divBlock2 m-low-nav">
        	<div class="m-filterNav">
                <div class="new-speechcraft new-speechcraft2 fl">
                    发起话术
                </div>
                <form class="search_form fl" onsubmit="return false;">
                    <input type="text" name="key_word" placeholder="请输入关键字" value=""/>
                    <button class="u-btnSearch" onclick="search_article()">查询</button>
                </form>
                {eq name="is_leader" value="1"}
                <div class="batch-manage fl">
                    <span class="out hide">退出</span>批量管理
                </div>
                {/eq}
                <div class="batch-delete hide">
                    批量删除
                </div>
                <div class="batch-change hide">
                    批量转移
                </div>               
            	<div class="clearfix"></div>
            </div>
        </section>
        <div class="manageNav m-filterNav hide" data-status="false">
            <input type="checkbox" /><span>全选</span>
            <select class="select_class">
                <option value="0">分类</option>
                {volist name="article_type" id="vo"}
                <option value="{$vo.id}">{$vo.type_name}</option>
                {/volist}
            </select>
            <select>
                <option>发表时间</option>
            </select>
        </div>
        <ul class="speech-list">
        {if condition="$all_article neq null"}
            {volist name="all_article" id="vo"}
                {eq name="vo.in_show" value="1"}
                <!-- onclick="article_info_show('{$vo.id}');" -->
                <li class="" data-status = "true"; data-craft-id="{$vo.id}"  {eq name="vo.in_top" value="1"} class="speech-hot" {/eq}>
                    <input type="checkbox" value="{$vo.id}" />
                    <h1>{$vo.article_name}{eq name="vo.in_top" value="1" }<span class="hot">置顶</span>{/eq}</h1>
                    <h2>{$vo.article_content}</h2>
                    <select class="delete-change-set">
                        <option>   </option>
                        <option value="1">删除话术</option>
                        <option value="2">修改分类</option>
                        <option value="3">设为置顶</option>
                    </select>
                    <h3>更新时间：<span>{$vo.article_edit_time|time_format}</span></h3>
                    {if condition="$vo.add_user eq $uid"}
                    <div class="controler">
                        <div class="edit3" data-id="{$vo.id}" ><i class="fa fa-file-text-o fa-2x"></i></div>
                        <div class="delete" data-id="{$vo.id}"><i class="fa fa-trash-o fa-2x"></i></div>
                    </div>
                    {/if}
                </li>
                {/eq}
            {/volist}
            {else/}
            {eq name="is_leader" value="1"}
            <h2 class="no-list">该分类还未添加话术，您可以<span class="color-blue new-speechcraft2">添加话术</span>，也可以<span class="color-blue delete-speech-class">删除分类</span></h2>
            {/eq}
            {/if}
        </ul>
        <div class="popUp delete-change-set-container hide">
            
        </div>
	</div>  
</div>
<link rel="stylesheet" href="/knowledgebase/css/index.css" />
<link rel="stylesheet" href="/static/css/popUp.css" />
<script src="/knowledgebase/js/index.js"></script>
<script type="text/javascript">   
    let status = true;//这个值代表是否处于批量管理状态；true代表正常浏览状态，false代表批量管理状态
    function article_info_show(id,t){  
    status =  !$(".knowledgebase_speechcraft_index .speech-list li").hasClass("manage-list-model"); 
    if (status) {
        var url = "/knowledgebase/speech_craft/show/id/"+id;
        var panel = 'speech-databasefr';
        loadPage(url,panel);
    }else{
        
    }
}
$(".knowledgebase_speechcraft_index .speech-list li .controler .edit3").click(function(){

    console.log(111);
    edit_article_info($(this).attr("data-id"),this);
});
$(".knowledgebase_speechcraft_index .speech-list li").click(function(){

    article_info_show($(this).attr("data-craft-id"),this);
});
function search_article(){
    var key_word = $("input[name='key_word']").val();
    var url = "/knowledgebase/speech_craft/index/key_word/"+key_word;
    var panel = 'speech-databasefr';
    loadPage(url,panel);

}
$(".knowledgebase_speechcraft_index header .m-firNav li").click(function(){
    show_class_article($(this).attr("speechcraft_in_column"),$(this).index());
});
function show_class_article(class_id,num){  
    var url = "/knowledgebase/speech_craft/index/class_id/"+class_id;
    var panel = 'speech-databasefr';
    loadPage(url,panel);
    $(".knowledgebase_speechcraft_index .in_column").eq(num).addClass("current").siblings().removeClass("current");
}
function edit_article_info(id,t){
    var url = "/knowledgebase/speech_craft/add_article/id/"+id;
    var panel = 'speech-databasefr';
    loadPage(url,panel);
}
// 批量管理

let status2 = true;//这个值代表操作全选按钮
$(".knowledgebase_speechcraft_index .batch-manage").click(function(){
    status =  !$(".knowledgebase_speechcraft_index .speech-list li").hasClass("manage-list-model");
    if(status){
        in_batch_manage();
        status = !status;//状态变更
        status2 = true;
        console.log("A");
    }else{
        out_batch_manage();
        status = !status;//状态变更
        status2 = false;
        console.log("B");
    }    
});
function in_batch_manage(){
    $(".knowledgebase_speechcraft_index .batch-manage").children(".out").removeClass("hide");
    $(".knowledgebase_speechcraft_index .speech-list li").addClass("manage-list-model");
    $(".knowledgebase_speechcraft_index .manageNav").removeClass("hide");
    $(".knowledgebase_speechcraft_index .batch-delete").removeClass("hide");
}
function out_batch_manage(){
    $(".knowledgebase_speechcraft_index .batch-manage").children(".out").addClass("hide");
    $(".knowledgebase_speechcraft_index .speech-list li").removeClass("manage-list-model");
    $(".knowledgebase_speechcraft_index .manageNav").addClass("hide");
    $(".knowledgebase_speechcraft_index .batch-delete").addClass("hide");
}
//批量管理时分类选择
$(".knowledgebase_speechcraft_index .select_class").change(function(){
        let val = $(this).val();
        let arr = getElementByAttr("li", "speechcraft_in_column", val);
        console.log($(arr[0]).index());

        var url = "/knowledgebase/speech_craft/index/class_id/"+$(this).val();
        var panel = 'speech-databasefr';
        loadPage(url,panel);
        $(".knowledgebase_speechcraft_index .in_column").eq($(arr[0]).index()).addClass("current").siblings().removeClass("current");
        in_batch_manage();
    });
//全选中操作
$(".knowledgebase_speechcraft_index .manageNav input[type='checkbox']").click(function(){
    if(status2){
        $(".knowledgebase_speechcraft_index .speech-list li input[type='checkbox']").attr("checked","checked").prop("checked",true);
        $(this).attr("checked","checked").prop("checked",true);
        status2=!status2;
    }else{
        $(".knowledgebase_speechcraft_index .speech-list li input[type='checkbox']").removeAttr("checked").prop("checked",false);
        $(this).removeAttr("checked").prop("checked",false);
        status2=!status2;
    }
});
$(".knowledgebase_speechcraft_index .speech-list li .controler .delete").click(function(){
    var article_id = $(this).attr('data-id');
    var delete_ids = "ids[]="+article_id;
    $.ajax({
        url: '/knowledgebase/speech_craft/delete',
        type: 'POST',
        dataType: 'json',
        data: delete_ids,
        success:function(data){
            layer.msg(data.info,{icon:data.status==1?1:2});
            if(data.status) {
                loadPage("/knowledgebase/speech_craft/index", "speech-databasefr");
            }
        },
        error:function(){
            layer.msg('删除失败!',{icon:2});
        }
    }); 
});
/*$(".knowledgebase_speechcraft_index .speech-list").on('click','.delete',function(){
    var article_id = $(this).attr('data-id');
    var delete_ids = "ids[]="+article_id;
    $.ajax({
        url: '/knowledgebase/speech_craft/delete',
        type: 'POST',
        dataType: 'json',
        data: delete_ids,
        success:function(data){
            layer.msg(data.info,{icon:data.status==1?1:2});
            if(data.status) {
                loadPage("/knowledgebase/speech_craft/index", "speech-databasefr");
            }
        },
        error:function(){
            layer.msg('删除失败!',{icon:2});
        }
    }); 
});*/

$(".knowledgebase_speechcraft_index .batch-delete").click(function(){
    var ids_arr = new Array();
    $(".knowledgebase_speechcraft_index .speech-list li input[type='checkbox']:checked").each(function(index, el) {
        ids_arr[index] = $(this).val();
    });
    console.log(ids_arr);
    if(ids_arr==""){
        return;
    }
    $.ajax({
        url: '/knowledgebase/speech_craft/delete',
        type: 'POST',
        dataType: 'json',
        data: {'ids':ids_arr},
        success:function(data){
            layer.msg(data.info,{icon:data.status==1?1:2});
            if(data.status) {
                loadPage("/knowledgebase/speech_craft/index", "speech-databasefr");
            }
        },
        error:function(){
            layer.msg('删除失败!',{icon:2});
        }
    });
    
});

</script>
<script src="/static/js/PopUp.js"></script>
<script>
    $(".knowledgebase_speechcraft_index .delete-change-set").change(function(){
        let id = $(this).parents().attr("data-craft-id");
        if($(this).val()==1){
            let pop =  new popLoad(".knowledgebase_speechcraft_index .delete-change-set-container","/knowledgebase/speech_craft/deleteSpeechList");
            $(".delete-change-set-container .deleteCraft").attr("data-craft-id",id);
        }else if($(this).val()==2){
            let pop =  new popLoad(".knowledgebase_speechcraft_index .delete-change-set-container","/knowledgebase/speech_craft/changeSpeechClass");
            $(".delete-change-set-container .change_class_form").attr("data-id",id);
        }else if($(this).val()==3){
            let pop =  new popLoad(".knowledgebase_speechcraft_index .delete-change-set-container","/knowledgebase/speech_craft/setTop");
            $(".delete-change-set-container .set_top_form").attr("data-id",id);
        }
        $(this).val(0);
    });
    $(".knowledgebase_speechcraft_index .delete-speech-class").click(function(){
        let pop =  new popLoad(".knowledgebase_speechcraft_index .delete-change-set-container","/knowledgebase/speech_craft/deleteSpeechClass");
    });
    // var pop1 = new popLoad("knowledgebase_speechcraft_index .delete-speech-list-container","/knowledgebase/speech_craft/delete_speech_list/",".knowledgebase_speechcraft_index .delete-speech-list");
</script>