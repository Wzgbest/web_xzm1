<div class="knowledgebase knowledgebase_speechcraft knowledgebase_speechcraft_index">
	<div class="index_panel index">
		<header>
            <ul class="m-firNav">
                <li in_column="0" class="in_column current" onclick="show_class_article('0');"><div>所有分类</div></li>
                {volist name="article_type" id="vo"}
                <li in_column="{$vo.id}" class="in_column " onclick="show_class_article('{$vo.id}');"><div>{$vo.type_name}</div></li>
                {/volist}
                <!--<li in_column="1" class="in_column "><div>百度业务</div></li>
                <li in_column="2" class="in_column "><div>网站建设</div></li>-->
            </ul>
        </header>
        <section class="m-divBlock m-divBlock2">
        	<div class="m-filterNav">
                <div class="new-speechcraft new-speechcraft2 fl">
                    发起话术
                </div>
                <form class="search_form fl" onsubmit="return false;">
                    <input type="text" name="key_word" placeholder="请输入关键字" value=""/>
                    <button class="u-btnSearch" onclick="search_article()">查询</button>
                </form>
                {eq name="is_leader" value="1"}
                <div class="batch-manage fl">
                    <span class="out hide">退出</span>批量管理
                </div>
                {/eq}
                <div class="batch-delete hide">
                    批量删除
                </div>               
            	<div class="clearfix"></div>
            </div>
        </section>
        <div class="manageNav m-filterNav hide" data-status="false">
            <input type="checkbox" /><span>全选</span>
            <select class="select_class">
                <option value="0">分类</option>
                {volist name="article_type" id="vo"}
                <option value="{$vo.id}">{$vo.type_name}</option>
                {/volist}
            </select>
            <select>
                <option>发表时间</option>
            </select>
        </div>
        <ul class="speech-list">
        {if condition="$all_article neq null"}
            {volist name="all_article" id="vo"}
                {eq name="vo.in_show" value="1"}
                <!-- onclick="article_info_show('{$vo.id}');" -->
                <li class="" data-status = "true"; data-craft-id="{$vo.id}" onclick="article_info_show('{$vo.id}',this);" {eq name="vo.in_top" value="1"} class="speech-hot" {/eq}>
                    <input type="checkbox" value="{$vo.id}" />
                    <h1>{$vo.article_name}{eq name="vo.in_top" value="1" }<span class="hot">置顶</span>{/eq}</h1>
                    <h2>{$vo.article_content}</h2>
                    <select class="delete-change-set">
                        <option>   </option>
                        <option value="1">删除话术</option>
                        <option value="2">修改分类</option>
                        <option value="3">设为置顶</option>
                    </select>
                    <h3>更新时间：<span>{$vo.article_edit_time|time_format}</span></h3>
                    {if condition="$vo.add_user eq $uid"}
                    <div class="controler">
                        <div class="edit3" onclick="edit_article_info('{$vo.id}',this);"><i class="fa fa-file-text-o fa-2x"></i></div>
                        <div class="delete" data-id="{$vo.id}"><i class="fa fa-trash-o fa-2x"></i></div>
                    </div>
                    {/if}
                </li>
                {/eq}
            {/volist}
            {else/}
            <h2 class="no-list">该分类还未添加话术，您可以<span class="color-blue new-speechcraft2">添加话术</span>，也可以<span class="color-blue delete-speech-class">删除分类</span></h2>
            {/if}
        </ul>
        <div class="popUp delete-change-set-container hide">
            
        </div>
	</div>  
</div>
<link rel="stylesheet" href="/knowledgebase/css/index.css" />
<link rel="stylesheet" href="/static/css/popUp.css" />
<script src="/knowledgebase/js/index.js"></script>
<script type="text/javascript">
    let status2 = true;
    function article_info_show(id,t){   
    if (status) {
        var url = "/knowledgebase/speech_craft/show/id/"+id;
        var panel = 'speech-databasefr';
        loadPage(url,panel);
    }else{
        // console.log($(t).children("input[type='checkbox']").attr("checked"));
        //选中操作---------------------
        /*if($(t).attr("data-status")=="true"){
            $(t).children("input[type='checkbox']").attr("checked","checked").prop("checked",true);
            $(t).attr("data-status","false");
        }else{
            $(t).children("input[type='checkbox']").removeAttr("checked").prop("checked",false);
            $(t).attr("data-status","true");
        }*/
    }
}
function search_article(){
    var key_word = $("input[name='key_word']").val();
    // alert(key_word);
    // var class_id = $(".current").attr("in_column");
    // alert(class_id);exit;
    var url = "/knowledgebase/speech_craft/index/key_word/"+key_word;
    var panel = 'speech-databasefr';
    loadPage(url,panel);

}
function show_class_article(class_id){  
    var url = "/knowledgebase/speech_craft/index/class_id/"+class_id;
    var panel = 'speech-databasefr';
    loadPage(url,panel);
    $(".knowledgebase_speechcraft_index .in_column").eq(class_id).addClass("current").siblings().removeClass("current");
}
function edit_article_info(id,t){
    var url = "/knowledgebase/speech_craft/add_article/id/"+id;
    var panel = 'speech-databasefr';
    loadPage(url,panel);
}
// 批量管理
let status = true;
$(".knowledgebase_speechcraft_index .batch-manage").click(function(){
    if(status){
        $(this).children(".out").removeClass("hide");
        $(".knowledgebase_speechcraft_index .speech-list li").addClass("manage-list-model");
        $(".knowledgebase_speechcraft_index .manageNav").removeClass("hide");
        $(".knowledgebase_speechcraft_index .batch-delete").removeClass("hide");
        status = !status;
        status2 = true;
        // 显示 no-list
        // if($(".knowledgebase_speechcraft_index .speech-list li").length==0){
        //     $(".knowledgebase_speechcraft_index .no-list").removeClass("hide");
        // }
    }else{
        $(this).children(".out").addClass("hide");
        $(".knowledgebase_speechcraft_index .speech-list li").removeClass("manage-list-model");
        $(".knowledgebase_speechcraft_index .manageNav").addClass("hide");
        $(".knowledgebase_speechcraft_index .batch-delete").addClass("hide");
        status = !status;
        status2 = false;
        // $(".knowledgebase_speechcraft_index .no-list").addClass("hide");
    }    
});
//全选中操作
$(".knowledgebase_speechcraft_index .manageNav input[type='checkbox']").click(function(){
    if(status2){
        $(".knowledgebase_speechcraft_index .speech-list li input[type='checkbox']").attr("checked","checked").prop("checked",true);
        $(this).attr("checked","checked").prop("checked",true);
        status2=!status2;
    }else{
        $(".knowledgebase_speechcraft_index .speech-list li input[type='checkbox']").removeAttr("checked").prop("checked",false);
        $(this).removeAttr("checked").prop("checked",false);
        status2=!status2;
    }
});

$(".knowledgebase_speechcraft_index .speech-list").on('click','.delete',function(){
    var article_id = $(this).attr('data-id');
    var delete_ids = "ids[]="+article_id;
    $.ajax({
        url: '/knowledgebase/speech_craft/delete',
        type: 'POST',
        dataType: 'json',
        data: delete_ids,
        success:function(data){
            layer.msg(data.info,{icon:data.status==1?1:2});
            if(data.status) {
                loadPage("/knowledgebase/speech_craft/index", "speech-databasefr");
            }
        },
        error:function(){
            layer.msg('删除失败!',{icon:2});
        }
    }); 
});

$(".knowledgebase_speechcraft_index .batch-delete").click(function(){
    var ids_arr = new Array();
    $(".knowledgebase_speechcraft_index .speech-list li input[type='checkbox']:checked").each(function(index, el) {
        ids_arr[index] = $(this).val();
    });
    console.log(ids_arr);
    if(ids_arr==""){
        return;
    }
    $.ajax({
        url: '/knowledgebase/speech_craft/delete',
        type: 'POST',
        dataType: 'json',
        data: {'ids':ids_arr},
        success:function(data){
            layer.msg(data.info,{icon:data.status==1?1:2});
            if(data.status) {
                loadPage("/knowledgebase/speech_craft/index", "speech-databasefr");
            }
        },
        error:function(){
            layer.msg('删除失败!',{icon:2});
        }
    });
    
});

</script>
<script src="/static/js/PopUp.js"></script>
<script>
    $(".knowledgebase_speechcraft_index .delete-change-set").change(function(){
        console.log($(this).val());
        let id = $(this).parents().attr("data-craft-id");
        if($(this).val()==1){
            let pop =  new popLoad(".knowledgebase_speechcraft_index .delete-change-set-container","/knowledgebase/speech_craft/deleteSpeechList");
            $(".delete-change-set-container .deleteCraft").attr("data-craft-id",id);
        }else if($(this).val()==2){
            let pop =  new popLoad(".knowledgebase_speechcraft_index .delete-change-set-container","/knowledgebase/speech_craft/changeSpeechClass");
            $(".delete-change-set-container .change_class_form").attr("data-id",id);
        }
        $(this).val(0);
    });
    $(".knowledgebase_speechcraft_index .delete-speech-class").click(function(){
        let pop =  new popLoad(".knowledgebase_speechcraft_index .delete-change-set-container","/knowledgebase/speech_craft/deleteSpeechClass");
    });
    // var pop1 = new popLoad("knowledgebase_speechcraft_index .delete-speech-list-container","/knowledgebase/speech_craft/delete_speech_list/",".knowledgebase_speechcraft_index .delete-speech-list");
</script>
<script type="text/javascript">
    $(".knowledgebase_speechcraft_index .select_class").change(function(){
        var url = "/knowledgebase/speech_craft/index/class_id/"+$(this).val();
        var panel = 'speech-databasefr';
        loadPage(url,panel);
        $(".knowledgebase_speechcraft_index .in_column").eq(class_id).addClass("current").siblings().removeClass("current");
    });
</script>